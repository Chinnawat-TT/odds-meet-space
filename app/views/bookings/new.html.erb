<h1 class="text-2xl font-bold mb-4">Book a Meeting Room</h1>

<script>
  document.addEventListener("DOMContentLoaded", () => {
  const bookedSlots = <%= @booked_slots.to_json %>; 

  const timeSelect = document.getElementById("booking_booking_time");
  const hourlySlotsDiv = document.getElementById("hourly_slots");

  function toggleHourlySlots() {
    if (timeSelect.value === "hourly") {
      hourlySlotsDiv.classList.remove("hidden");
    } else {
      hourlySlotsDiv.classList.add("hidden");
    }

   
    const checkboxes = hourlySlotsDiv.querySelectorAll("input[type='checkbox']");
    checkboxes.forEach((checkbox) => {
      const timeSlot = checkbox.dataset.timeSlot;
      if (bookedSlots.includes(timeSlot)) {
        checkbox.disabled = true;
      }
    });
  }

  timeSelect.addEventListener("change", toggleHourlySlots);
  toggleHourlySlots();
});

</script>


<%= form_with model: @booking, url: bookings_path, local: true do |f| %>
  <div>
    <%= f.label :meeting_room_id, "Meeting Room" %>
    <%= f.select :meeting_room_id, MeetingRoom.all.collect { |room| [room.name, room.id] }, { prompt: "Select a Meeting Room" }, class: "border p-2" %>
  </div>

  <div class="mt-4">
    <%= f.label :booking_date, "Date" %>
    <%= f.date_field :booking_date, min: Date.current, class: "border p-2" %>
  </div>

  <div class="mt-4">
    <%= f.label :booking_time, "Time Slot" %>
    <%= f.select :booking_time, [
      ["Morning (09:00–12:00)", "morning"],
      ["Afternoon (13:00–18:00)", "afternoon"],
      ["Full Day (09:00–18:00)", "full_day"],
      ["Custom - Hourly", "hourly"]
    ], { prompt: "Select a Time Slot" }, class: "border p-2", id: "booking_booking_time" %>
  </div>

  <div id="hourly_slots" class="mt-4 hidden">
    <label class="block font-medium mb-2">Select Hourly Slots</label>
    <% [
      "9:00 AM - 10:00 AM",
      "10:00 AM - 11:00 AM",
      "11:00 AM - 12:00 PM",
      "1:00 PM - 2:00 PM",
      "2:00 PM - 3:00 PM",
      "3:00 PM - 4:00 PM",
      "4:00 PM - 5:00 PM",
      "5:00 PM - 6:00 PM"
    ].each do |slot| %>
      <div>
        <label>
          <%= check_box_tag "booking[hourly_times][]", slot %>
          <%= slot %>
        </label>
      </div>
    <% end %>
  </div>

  <div class="mt-4">
    <%= f.label :reason %>
    <%= f.text_area :reason, class: "border p-2 w-full", required: true %>
  </div>

  <div class="mt-4">
    <%= f.label :email %>
    <%= f.email_field :email, class: "border p-2 w-full", required: true %>
  </div>

  <div class="mt-6">
    <%= f.submit "Book", class: "bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" %>
  </div><% if notice %>
  <p class="bg-green-100 text-green-800 px-4 py-2 rounded mb-4"><%= notice %></p>
<% end %>

<% if alert %>
  <p class="bg-red-100 text-red-800 px-4 py-2 rounded mb-4"><%= alert %></p>
<% end %>

<% if @booking && @booking.errors.any? %>
  <div class="bg-red-100 text-red-800 px-4 py-2 rounded mb-4">
    <h2>⚠️ Booking failed:</h2>
    <ul>
      <% @booking.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<% end %>

